# Сайт EyePoint

Больше информации

https://ximc.ru/issues/37198  
https://ximc.ru/issues/38120  
https://ximc.ru/issues/36703  

# Как развернуть

Нужно собрать и запустить контейнер: 
```bash
sudo docker build . -t epw
sudo docker run --publish 80:8080 --restart=always -d --mount source=download,target=/app/view/static/download epw
```
Обрати внимание: docker диск 'download' должен существовать. В этом разделе должны быть файлы для скачивания с сайта.
Подробно о том, как создать docker диск: 
https://docs.docker.com/storage/volumes/

Для тестов, без Docker, сайт можно просто запустить:
```bash
python -m pip install -r requirements.txt
python server.py
```
Сайт тестировался на python3.7
При тестовом запуске папка view/static/download должна существовать

Для пересборки контейнера на сервере можно использовать скрипт:
```bash
bash scripts/rebuild-docker.sh
```
Он удалит существующий контейнер, соберёт новый и запустит

# Как модифицировать

## Как добавить\удалить новый продукт

Описание всех продуктов лежит в файле data/products.py. Новый продукт нужно создать по образцу, добавив имя, путь к 
картинке, описание и список технических характеристик.  
Катинка продукта должна лежать в папке view/static/images (см. примеры других продуктов)

После добавления продукта, а также после исправления любого текста, который видит пользователь (описание, 
вводная часть, - любое слово, любая буква в интерфейсе) нужно обновлять файлы переводов

## Как обновить файлы переводов

Для обновления переводов есть специальный скрипт scripts/update-po-files.sh
Его нужно запустить из папки с проектом, т.е. как-то так:
```bash
bash scripts/update-po-files.sh
```
При этом пакет gettext должен быть установлен, pygettext3 должен быть установлен.

Этот скрипт просмотрит код сайта, найдёт все места, которые нуждаются в переводе на английский, и добавит в файл
перевода эти места.
Текст перевода нужно написать самому. Для этого удобно использовать программу Poedit. С её помощью нужно открыть файл
locale/en_US/LC_MESSAGES/en.po и добавить отсутствующие переводы.  
Обрати внимание: если сервер развёрнут локально (не Docker), нужно ещё скомпилировать эти переводы. За это отвечает 
скрипт scripts/rebuild-locale.sh

## Как добавить новый файл для скачивания

Если, например, для EyePoint_P10 вышла новая прошивка, достаточно просто положить её в docker volume в папку 
EyePoint_P10/firmware. Сервер обновляет список файлов регулярно каждые 10 минут  

## Как добавить новую группу для скачивания

Пусть, например, для EyePoint P10 появился новый софт (помимо "прошивки" и "драйвера") - например, "плагины" (plugins)  
Тогда в папке EyePoint_P10 (имя папки - как в "name" продукта, см. файл data/products) нужно создать папку plugins и 
накидать туда файлы для скачивания. Имена файлов нужно давать по образцу файлов в других папках.  
Новая группа появится автоматически на сайте.  
Но чтоб у этой группы было красивое имя (а не просто "plugins", как имя папки), нужно добавить новое имя в словарь 
_software_friendly_names в файле data/download.py по образцу других имён,а затем обновить файл перевода. Например:
```python
_software_friendly_names = {
    "documentation": _("Документация"),
    "driver": _("Драйвер"),
    "firmware": _("Прошивка"),
    "software": _("Софт"),
    "plugins": _("Плагины")
}
```
А в файле перевода добавить:
```
msgid "Плагины"
msgstr "Plugins"
```

# Прочее

Иконки флагов взяты с  
https://github.com/HatScripts/circle-flags.git  
Другие иконки взяты с  
https://www.iconsdb.com/white-icons/  
При добавлении новых иконок желательно брать из той же серии, чтобы хранить стиль.

За основу сайта взят бесплатный интернет-шаблон. Шаблон сильно переработан. Но в css\html всё ещё могут быть лишние 
фрагменты кода. 